<head>
<link rel="shortcut icon" href="https://ifh.cc/g/69rynC.png" />
<meta charset="UTF-8" />
<title>ê½ê½ ì–¼ì–´ë¶™ì€ í•œê°• ìœ„ì— ì¢…ì´ë¹„í–‰ê¸°ê°€</title>
<link rel="preconnect" href="https://fonts.googleapis.com" />
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
<link
  href="https://fonts.googleapis.com/css2?family=Gowun+Dodum&family=IBM+Plex+Sans+KR&family=Jua&display=swap"
  rel="stylesheet"
/>
</head>

<style>
body {
  margin: 0;
  width: 100vw;
  height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  background-color: black;
  overflow: hidden;
}

#world {
  background: linear-gradient(135deg, #aca1ff, #9283ff, #7f6efd);
  border-radius: 10px;
  overflow: hidden;
  position: absolute;
  min-width: 90vw;
  min-height: 90vh;
  box-shadow: inset -10px -10px 10px #00000040, inset 5px 5px 10px #ffffff40;
  transition: all 0.2s ease;
}

#world * {
  filter: none;
}

.object {
  position: absolute;
}

#player {
  position: absolute;
  background-color: transparent;
  box-shadow: 5px 5px 3px #00000050;
  transition: all 0.2s ease, width 1s ease, height 1s ease;
  border-radius: 7px;
  z-index: 1;
}

#player div {
  position: absolute;
  background: linear-gradient(
    135deg,
    #fdd8aa,
    #ffd07e,
    #fcbf57,
    #ffab44,
    #ffab44,
    #FF9830,
    #FF8000
  );
  transition: all 1s ease-out, width 1s ease, height 1s ease;
  border: none;
  border-radius: 7px;
  box-shadow: inset -2px -2px 2px #da891f90, inset -22px -22px 2px #ffffff50;
  width: 20px;
  height: 20px;
  animation: show 1s ease-in-out;
}

#fakePlayer {
  background: linear-gradient(
    135deg,
    #fdd8aa,
    #ffd07e,
    #fcbf57,
    #ffab44,
    #ffab44
  );
  transition: all 1s ease-out, width 1s ease, height 1s ease;
  border: none;
  border-radius: 7px;
  box-shadow: inset -2px -2px 2px #da891f90, inset -22px -22px 2px #ffffff50;
  width: 20px;
  height: 20px;
  animation: show 1s ease-in-out;
}

/*#player::after{
  content: '';
  position: absolute;
  top: -12px;
  left: -12px;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 2px solid rgba(255, 0, 0, 0.3);

}*/
.enemy {
  z-index: 5;
  position: absolute;
  width: 0;
  height: 0;
  border-style: solid;
  border-width: 0px 6px 13px 6px;
  border-color: transparent transparent #e7e5fa transparent;
  animation: show 1s ease-in-out;
  transform-origin: center center;
  transition: all 0.15s ease, transform 3s ease-out;
}

@keyframes show {
  0% {
    opacity: 0;
    transform: scale(0.5);
  }

  100% {
    opacity: 1;
  }
}

@keyframes stageSet {
  50% {
    transform: scale(1) translateY(-15px);
  }

  100% {
  }
}
@keyframes ì ì£½ìŒ {
  0% {
    transform: scale(1) rotate(0deg);
    opacity: 1;
    filter: blur(0);
  }
  30% {
    transform: scale(1.2) rotate(45deg);
    opacity: 1;
    filter: blur(2px);
  }
  50% {
    transform: scale(1.5) rotate(90deg);
    opacity: 0.8;
    filter: blur(4px);
  }
  70% {
    transform: scale(1) rotate(135deg);
    opacity: 0.5;
    filter: blur(6px);
  }
  100% {
    transform: scale(0) rotate(180deg);
    opacity: 0;
    filter: blur(10px);
  }
}

#stage {
  margin: 8px 12px;
  color: white;
  font-size: 40px;
  font-weight: bold;
  transition: all 1s ease;
  position: absolute;
  width: 200px;
  z-index: 100;
}

#score {
  transition: all 1s ease;
  margin: 135px 12px;
  color: #ffffff80;
  font-size: 30px;
  font-weight: bold;
  position: absolute;
  z-index: 100;
}

progress {
  width: 150px;
  height: 10px;
  border-radius: 10px;
  border: none;
  background-color: rgba(255, 255, 255, 0.1);
  appearance: none;
}

progress::-webkit-progress-bar {
  background-color: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
}

progress::-webkit-progress-value {
  transition: all 0.5s ease;
  background-color: rgba(255, 255, 255, 0.5);
  border-radius: 10px;
}

progress::-moz-progress-bar {
  transition: all 0.5s ease;
  background-color: rgba(255, 255, 255, 0.5);
  border-radius: 10px;
}
#window {
  position: absolute;
  z-index: 10;
  width: 400px;
  border-radius: 10px;
  padding: 20px;
  box-shadow: 0px 0px 5px #00000030;
  display: flexbox;
  justify-content: center;
  justify-items: center;
  align-items: center;
  align-content: center;
  transition: height 0.5s ease;
  background-color: #25222180;
  color: #FFF2E1;
  backdrop-filter: blur(5px);
}

.window-holder {
  position: absolute;
  z-index: 0;
  width: 100vw;
  height: 100vh;
  background-color: #00000080;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 100;
  backdrop-filter: blur(2px);
}

#close {
  transition: all 0.5s ease;
  display: none;
}
#window-cont {
  width: 390px;
}

button {
  border-radius: 20px;
  background-color: #00000060;
  color: #ffffffcc;
  font-weight: bold;
  transition: all 0.3s ease;
  padding: 8px 16px;
  border: none;
  height: 46px;
  width: 200px;
  font-size: 16px;
  cursor: pointer;
  opacity: 0;
  animation: showB 0.5s ease-in-out;
}

@keyframes showB {
  0% {
    opacity: 0;
  }
  100% {
    opacity: 1;
  }
}
button:hover {
  background-color: #FFFFFF10;
  transform: translateY(-3px) scale(1.02);
  filter : brightness(1.5);
}

button:active {
  transform: scale(0.95);
}

#name {
  position: absolute;
  bottom: 15px;
  right: 15px;
  font-weight: bold;
  color: #ffffff60;
}
.highlight {
  font-weight: bold;
}

.bomb {
  position: absolute;
  width: 10px;
  height: 10px;
  background-color: #ffe8c9;
  border-radius: 50%;
  box-shadow: 4px 4px 4px #554698, inset -3px -3px 5px #da891f90;
  z-index: 0;
  animation: í­íƒ„ìƒì„± 0.8s ease-out;
}
@keyframes í­íƒ„ìƒì„± {
  0% {
    transform: translate(0, 0) scale(1.1);
  }
  28% {
    transform: translate(0, -15px) scale(1.1);
  }
  65% {
    transform: translate(0, 0) scale(1);
  }
  85% {
    filter:brightness(1.5)
  }
  100% {
    filter:brightness(1)
  }
}

@keyframes í­ë°œ {
  0% {
    background-color: #FF4141;
    transform: scale(1);
    opacity: 1;
    box-shadow: 0 0 4px 2px rgba(255, 85, 85, 0.7),
      0 0 6px 3px rgba(255, 140, 0, 0.5);
  }
  30% {
    background-color: #FF4141;
    transform: scale(2);
    opacity: 0.8;
    box-shadow: 0 0 4px 2px rgba(255, 85, 85, 0.8),
      0 0 5px 3px rgba(255, 140, 0, 0.4); 
  }
  50% {
    background-color: #FF6141;
    transform: scale(4);
    opacity: 0.6;
    box-shadow: 0 0 6px 3px rgba(255, 120, 120, 0.8),
      0 0 5px 4px rgba(255, 85, 85, 0.5); 
  }
  80% {
    background-color:#FF6141;
    transform: scale(6);
    opacity: 0.4;
    box-shadow: 0 0 8px 4px rgba(255, 85, 85, 0.8),
      0 0 5px 4px rgba(255, 140, 0, 0.6);
  }
  100% {
    background-color: #FF6141;
    transform: scale(12);
    opacity: 0;
    box-shadow: 0 0 8px 4px rgba(255, 85, 85, 0.8); 
  }
}

@keyframes ê°œì©–í­ë°œ {
  0% {
    background-color: rgba(255, 85, 85, 1);
    transform: scale(1);
    opacity: 1;
    box-shadow: 0 0 4px 2px rgba(255, 85, 85, 0.7),
      0 0 6px 3px rgba(255, 140, 0, 0.5);
  }
  30% {
    background-color: rgba(255, 105, 105, 1);
    transform: scale(30);
    border-radius:10px;
    opacity: 0.8;
    box-shadow: 0 0 4px 2px rgba(255, 85, 85, 0.8),
      0 0 6px 3px rgba(255, 140, 0, 0.4); 
  }
  50% {
    background-color: rgba(255, 120, 120, 1);
    transform: scale(10);
    opacity: 0.6;
    box-shadow: 0 0 6px 3px rgba(255, 120, 120, 0.8),
      0 0 8px 4px rgba(255, 85, 85, 0.5); 
  }
  80% {
    background-color: rgba(255, 85, 85, 1);
    transform: scale(50);
    opacity: 0.4;
    box-shadow: 0 0 8px 4px rgba(255, 85, 85, 0.8),
      0 0 10px 5px rgba(255, 140, 0, 0.6);
  }
  100% {
    background-color: rgba(255, 85, 85, 0);
    transform: scale(100);
    opacity: 0;
    box-shadow: 0 0 10px 5px rgba(255, 85, 85, 0.8); 
  }
}


.separator {
  margin: 20px 0;
}

.separator hr {
  width: 30%;
  height: 2px;
  background-color: #FFFFFF50;
  border: none;
}

.highlight {
  color: #FFCA85;
}

.abilities-section {
  font-size: 17px;
  font-weight: bold;
}

.skill-card {
  margin: 5px;
  padding: 5px;
  background-color: #3f3a3999;
  color: white;
  border-radius: 5px;
  text-align: center;
  transition:all 0.5s ease;
  animation:show 0.5s ease;
  font-size:15px;
  border: 5px solid #FFFFFF00;
  box-shadow: 0px 0px 0px #00000000
}

.section-title {
  font-size: 18px;
}

.skill-card:hover{
  transform : scale(1.04) translateY(-8px);
  filter : brightness(1.3);
  border: 5px solid #635959;
  box-sizing: border-box;
  box-shadow: 0px 5px 1px #FFFFFF30
}  

.skill-card:active{
  transform : scale(0.9) translateY(5px);
  filter : brightness(0.9);
}  
</style>

<div id="world">
<div id="name" onclick="window.location.href='park0sec.vercel.app'">
  @ìƒ›ë³„ì½”ë”©ë™ì•„ë¦¬íšŒì¥
</div>
<div id="player_range">
  <div id="player">
    <div id="player-dis"></div>
  </div>
</div>
<div id="stage" class="object" style="z-index: 1">#ê³ ë¼ë‹ˆëŠ” ê·€ì—½ìŠµë‹ˆë‹¤</div>
<progress
  id="score"
  class="object"
  style="z-index: 1"
  value="3"
  max="3"
></progress>
<div id="gameOver"></div>
</div>

<script>
// ì‹œìŠ¤í…œ í•¨ìˆ˜ ì„¤ì •
function HTML(name) {
  return document.querySelector(name);
}

function ëœë¤(min, max) {
let state = Date.now() + Math.random() * 1000000;//ìµœëŒ€í•œ ë‹¤ë¥´ê²Œ
const random = () => {
  state = (state * 16807) % 2147483647;
  return state / 2147483647;
};
return Math.floor(random() * (max - min + 1)) + min;
}



// ê²Œì„ í•¨ìˆ˜ ì„¤ì •
const ì„¤ì •ê°ì²´ = {
  ì£¼ì¸ê³µí¬ê¸°: { x: 20, y: 20 },
  ì›”ë“œí¬ê¸°: { x: 1300, y: 700 },
};
const keyIntervals = {};
const ì˜¤ë¸Œì íŠ¸ = {};
let ì¶©ëŒì¤‘ë³µë°©ì§€ = true;

async function ê¸°ë³¸ì„¤ì •() {
  const ì£¼ì¸ê³µ = HTML('#player');
  const ì›”ë“œ = HTML('#world');
  ì›”ë“œí¬ê¸° = { x: ì›”ë“œ.clientWidth, y: ì›”ë“œ.clientHeight };
  //ì›”ë“œ.style.minWidth = `${ì„¤ì •ê°ì²´.ì›”ë“œí¬ê¸°.x}px`;
  //ì›”ë“œ.style.minHeight = `${ì„¤ì •ê°ì²´.ì›”ë“œí¬ê¸°.y}px`;

  ì£¼ì¸ê³µ.style.width = `${ì„¤ì •ê°ì²´.ì£¼ì¸ê³µí¬ê¸°.x}px`;
  ì£¼ì¸ê³µ.style.height = `${ì„¤ì •ê°ì²´.ì£¼ì¸ê³µí¬ê¸°.y}px`;
  ì£¼ì¸ê³µ.style.top = `${
    ì›”ë“œ.getBoundingClientRect().height / 2 - ì„¤ì •ê°ì²´.ì£¼ì¸ê³µí¬ê¸°.y / 2
  }px`;
  ì£¼ì¸ê³µ.style.left = `${
    ì›”ë“œ.getBoundingClientRect().width / 2 - ì„¤ì •ê°ì²´.ì£¼ì¸ê³µí¬ê¸°.x / 2
  }px`;
  ì˜¤ë¸Œì íŠ¸['#player'] = {
    name: '#player',
    x: parseInt(ì£¼ì¸ê³µ.style.left),
    y: parseInt(ì£¼ì¸ê³µ.style.top),
    deg: 0,
  };
}
function ì êµ°ìƒì„±(num) {
  const player = HTML('#player');
  const playerRect = player.getBoundingClientRect();
  const playerX = playerRect.left + playerRect.width / 2;
  const playerY = playerRect.top + playerRect.height / 2;
  const minDistance = 200;

  for (let i = 0; i < num; i++) {
    let randomX, randomY, distance;

    do {
      randomX = Math.floor(Math.random() * ì„¤ì •ê°ì²´.ì›”ë“œí¬ê¸°.x);
      randomY = Math.floor(Math.random() * ì„¤ì •ê°ì²´.ì›”ë“œí¬ê¸°.y);

      distance = Math.sqrt(
        Math.pow(randomX - playerX, 2) + Math.pow(randomY - playerY, 2)
      );
    } while (distance < minDistance);
    ì ì¹´ìš´í„°++;
    const ì êµ° = document.createElement('div');
    ì êµ°.classList.add('enemy');
    ì êµ°.id = `enemy${ì ì¹´ìš´í„°}`;
    ì êµ°.innerHTML = `<div class="shadow"></div>`;
    HTML('#world').appendChild(ì êµ°);

    ì êµ°.style.top = `${randomY}px`;
    ì êµ°.style.left = `${randomX}px`;
    ì˜¤ë¸Œì íŠ¸[`#enemy${ì ì¹´ìš´í„°}`] = {
      name: `#enemy${ì ì¹´ìš´í„°}`,
      x: randomX,
      y: randomY,
      alive: true,
      type:'norm',
      deg: Math.floor(Math.random() * 180) + 1,
    };
    if(ëœë¤(1,40)>(40-ë ˆë²¨*1)){
      HTML(`#enemy${ì ì¹´ìš´í„°}`).style.borderColor = 'transparent transparent black transparent';
      ì˜¤ë¸Œì íŠ¸[`#enemy${ì ì¹´ìš´í„°}`].type = 'spec'
    }
  }
}
let ìµœì¢…ì ìˆ˜ = 0
function ê²Œì„ì˜¤ë²„() {
  HTML('#world').style.filter = ``;
  let count=0;
  for (let char of skillType) {
    if (char === ',') {
    count++;
}
}
ìµœì¢…ì ìˆ˜ = ë ˆë²¨-1
ìµœì¢…ì ìˆ˜-=count;
if(ìµœì¢…ì ìˆ˜<0){ìµœì¢…ì ìˆ˜ = 0};
  windowAlert(
    'ê²Œì„ì˜¤ë²„',
    `
  ì‚¬ë§í•˜ì˜€ìŠµë‹ˆë‹¤ ğŸ˜“
  <div style = "margin:20px;"><hr style="width: 30%; height: 2px; background-color: #FFFFFF50; border: none;">
</div>
  ğŸ†ì ìˆ˜ â€¢ <span class = "highlight">${ìµœì¢…ì ìˆ˜}</span>${(admin)?' (ê´€ë¦¬ìëª¨ë“œ)':''}
  <div></div>
  ğŸ“œê²°ê³¼ì½”ë“œ â€¢ <span class = "highlight">${ì½”ë“œ()}</span>
  <div></div><div style = "font-size:12px">(ì˜†ì— ë°°ì¹˜ëœ í¬ìŠ¤íŠ¸ì‡ì— ì´ ì½”ë“œë¥¼ ì ê³  ë³´ìƒì„ ë°›ìœ¼ëŸ¬ ê°€ë³´ì„¸ìš”!)</div>
  `,
    'ë‹¤ì‹œí”Œë ˆì´',
    '/*location.reload()*/window.alert(`ë™ì•„ë¦¬ ë¶€ì›ì—ê²Œ ìš”ì²­í•´ì£¼ì„¸ìš”! í”Œë ˆì´ íšŸìˆ˜ë¥¼ ë§ì¶”ê¸° ìœ„í•¨ì…ë‹ˆë‹¤!`);'
  );
  HTML('#world').style.filter = ``;
}

function ì‹œê°„í¬ë©§() {
  const now = new Date();
  const day = String(now.getDate()).padStart(2, '0');
  const hours = String(now.getHours()).padStart(2, '0');
  const minutes = String(now.getMinutes()).padStart(2, '0');

  return `${day}${hours}${minutes}`;
}

function ìˆ«ìì•”í˜¸í™”(input) {
  const map = {
    1: 'A',
    2: 'B',
    3: 'C',
    4: 'D',
    5: 'E',
    6: 'F',
    7: 'G',
    8: 'H',
    9: 'I',
    0: 'J',
  };

  return input.replace(/[0-9]/g, (match) => map[match]);
}

function ì½”ë“œ() {
  let result = 'Z1' + ìˆ«ìì•”í˜¸í™”(String(ìµœì¢…ì ìˆ˜));
  result += '2';
  result += ìˆ«ìì•”í˜¸í™”(ì‹œê°„í¬ë©§());
  result += (admin)?'RRM':''
  return result;
}

function ì´ë™(name, dx, dy) {
  const ìš”ì†Œ = document.querySelector(name);
  const world = HTML('#world');
  const padding = 18;

  if (!ìš”ì†Œ) return;

  const currentX = parseFloat(ìš”ì†Œ.style.left || 0);
  const currentY = parseFloat(ìš”ì†Œ.style.top || 0);
  const newX = Math.max(
    padding,
    Math.min(world.offsetWidth - ìš”ì†Œ.offsetWidth - padding, currentX + dx)
  );
  const newY = Math.max(
    padding,
    Math.min(world.offsetHeight - ìš”ì†Œ.offsetHeight - padding, currentY + dy)
  );

  ìš”ì†Œ.style.left = `${newX}px`;
  ìš”ì†Œ.style.top = `${newY}px`;
  if (ì˜¤ë¸Œì íŠ¸[name]) {
    ì˜¤ë¸Œì íŠ¸[name].x = newX;
    ì˜¤ë¸Œì íŠ¸[name].y = newY;
  }
}

let skillType = "";
let playerSpeed = 35;
async function ì êµ°ê±°ë¦¬ê³„ì‚°() {
  if (ì¶©ëŒì¤‘ë³µë°©ì§€) {
    const player = HTML('#player');
    const playerRect = player.getBoundingClientRect();
    //ì†”ê¹Œ íšŒì „í•œ ì‚¼ê°í˜• ê¼­ì§“ì  ê°€ì§€ê³  ë„“ì´ ë²”ìœ„ êµ¬í•˜ëŠ”ì§“ì€ ëª»í•˜ê² ìŒ ã……ã„±
    const ì êµ°ë“¤ = document.querySelectorAll('.enemy');
    for (let ì êµ° of ì êµ°ë“¤) {
      const enemyRect = ì êµ°.getBoundingClientRect();
      const overlap = !(
        playerRect.right < enemyRect.left ||
        playerRect.left > enemyRect.right ||
        playerRect.bottom < enemyRect.top ||
        playerRect.top > enemyRect.bottom
      );

      if (overlap) {
        ì¶©ëŒì¤‘ë³µë°©ì§€ = false;
        const ì êµ°Id = ì êµ°.id;
        const ì êµ°ì˜¤ë¸Œì íŠ¸ = ì˜¤ë¸Œì íŠ¸[`#${ì êµ°Id}`];
        console.log(ì êµ°ì˜¤ë¸Œì íŠ¸.alive);
        if (ì êµ°ì˜¤ë¸Œì íŠ¸.alive) {
          ì êµ°ì˜¤ë¸Œì íŠ¸.deg = (ì êµ°ì˜¤ë¸Œì íŠ¸.deg + 180) % 360;
          const ì´ë™ê±°ë¦¬ = Math.random() * 20 + 50;
          await ë°©í–¥ì´ë™(ì êµ°Id, ì êµ°ì˜¤ë¸Œì íŠ¸.deg, ì´ë™ê±°ë¦¬);

          HTML('#player').style.filter = 'brightness(1.1) contrast(1.5)';
          HTML('#world').style.filter = `contrast(${1.1 + (ë ˆë²¨ - 1) * 0.1})`;
          HTML('#score').value -= 1;
          setTimeout(() => {
            ì¶©ëŒì¤‘ë³µë°©ì§€ = true;
            HTML('#player').style.filter = '';
            HTML('#world').style.filter = `contrast(${1 + (ë ˆë²¨ - 1) * 0.1})`;
          }, 100);
          if (HTML('#score').value == 0) {
            ê²Œì„ì˜¤ë²„();
          }
          break;
        }
      }
    }
  }
}
let admin = false;
let ìŠ¤í‚¬ì¿¨íƒ€ì„ = false;
function í† ê¸€(str, word) { //ê·€ì°¨ë‹ˆì¦˜
if (str.includes(word)) {
  return str.replace(word, '');
} else {
  return str + word;
}
}
document.addEventListener('keydown', (e) => {
  if (!keyIntervals[e.key]) {
    if (e.key === 'a') {
      keyIntervals[e.key] = setInterval(() => {
        ì´ë™('#player', -playerSpeed, 0);
      }, 150);
    } else if (e.key === 'd') {
      keyIntervals[e.key] = setInterval(() => {
        ì´ë™('#player', playerSpeed, 0);
      }, 150);
    } else if (e.key === 'w') {
      keyIntervals[e.key] = setInterval(() => {
        ì´ë™('#player', 0, -playerSpeed);
      }, 150);
    } else if (e.key === 's') {
      keyIntervals[e.key] = setInterval(() => {
        ì´ë™('#player', 0, playerSpeed);
      }, 150);
    } else if ((e.key === ' ' || e.key === 'q') && skillType.includes('bomb')) {
  if (!ìŠ¤í‚¬ì¿¨íƒ€ì„) {
      í­íƒ„ë°°ì¹˜(ì˜¤ë¸Œì íŠ¸['#player'].x, ì˜¤ë¸Œì íŠ¸['#player'].y); 
      ìŠ¤í‚¬ì¿¨íƒ€ì„ = true;
      setTimeout(() => {
          ìŠ¤í‚¬ì¿¨íƒ€ì„ = false;
      }, 1500); 
      keyIntervals[e.key] = setInterval(() => {
        if (!ìŠ¤í‚¬ì¿¨íƒ€ì„) {
            í­íƒ„ë°°ì¹˜(ì˜¤ë¸Œì íŠ¸['#player'].x, ì˜¤ë¸Œì íŠ¸['#player'].y);
            ìŠ¤í‚¬ì¿¨íƒ€ì„ = true;
            setTimeout(() => {
                ìŠ¤í‚¬ì¿¨íƒ€ì„ = false; 
            }, 1000);
        }
      }, 1000);
  }
}
  }
});

document.addEventListener('keyup', (e) => {
  if (keyIntervals[e.key]) {
    setTimeout(() => {
      clearInterval(keyIntervals[e.key]);
      delete keyIntervals[e.key];
    }, 100);
  }
});
function ì êµ°ì´ë™() {
const player = HTML('#player');
const playerRect = player.getBoundingClientRect();
const playerX = playerRect.left + playerRect.width / 2;
const playerY = playerRect.top + playerRect.height / 2;

for (const key in ì˜¤ë¸Œì íŠ¸) {
  const ëŒ€ìƒì˜¤ë¸Œì íŠ¸ = ì˜¤ë¸Œì íŠ¸[key];
  if (!ëŒ€ìƒì˜¤ë¸Œì íŠ¸.name.includes('player')) {
    if (!ëŒ€ìƒì˜¤ë¸Œì íŠ¸.alive) {
      continue;
    }
    const ì êµ° = HTML(ëŒ€ìƒì˜¤ë¸Œì íŠ¸.name);
    const ì êµ°Rect = ì êµ°.getBoundingClientRect();
    const ì êµ°X = ì êµ°Rect.left + ì êµ°Rect.width / 2;
    const ì êµ°Y = ì êµ°Rect.top + ì êµ°Rect.height / 2;

    if (Math.floor(Math.random() * 100) > 96 - ë ˆë²¨ * 2) {
      const í”Œë ˆì´ì–´ë°©í–¥ =
        Math.atan2(playerY - ì êµ°Y, playerX - ì êµ°X) * (180 / Math.PI);
      ëŒ€ìƒì˜¤ë¸Œì íŠ¸.deg = í”Œë ˆì´ì–´ë°©í–¥;
    } else {
      ëŒ€ìƒì˜¤ë¸Œì íŠ¸.deg += Math.random() * 4.5;
    }
    //ëŒ€ìƒì˜¤ë¸Œì íŠ¸.deg*=(ëœë¤(0.95,1.05)/**(ë ˆë²¨*0.1)*/)

    let ì´ë™ê±°ë¦¬ = Math.random() * 20 + 15 + ë ˆë²¨ * 12;
    if (skillType.includes('lower')) {
      ì´ë™ê±°ë¦¬ *= 1.5;
    }
    if(ëŒ€ìƒì˜¤ë¸Œì íŠ¸.type == 'spec'){
      ì´ë™ê±°ë¦¬ *= 2;
    }
    let ì´ë™X = ì´ë™ê±°ë¦¬ * Math.cos(ëŒ€ìƒì˜¤ë¸Œì íŠ¸.deg * (Math.PI / 180));
    let ì´ë™Y = ì´ë™ê±°ë¦¬ * Math.sin(ëŒ€ìƒì˜¤ë¸Œì íŠ¸.deg * (Math.PI / 180));

    const ì›”ë“œ = HTML('#world');
    const ì›”ë“œRect = ì›”ë“œ.getBoundingClientRect();

    const ì˜ˆìƒX = ì êµ°Rect.left + ì´ë™X;
    const ì˜ˆìƒY = ì êµ°Rect.top + ì´ë™Y;

    // ë²½ê¹Œì§€ ë‚¨ì€ ê±°ë¦¬ ê³„ì‚°
    const ë‚¨ì€ê±°ë¦¬X = ì˜ˆìƒX < ì›”ë“œRect.left
      ? ì›”ë“œRect.left - ì êµ°Rect.left
      : ì˜ˆìƒX + ì êµ°Rect.width > ì›”ë“œRect.right
      ? ì›”ë“œRect.right - (ì êµ°Rect.left + ì êµ°Rect.width)
      : ì´ë™X;

    const ë‚¨ì€ê±°ë¦¬Y = ì˜ˆìƒY < ì›”ë“œRect.top
      ? ì›”ë“œRect.top - ì êµ°Rect.top
      : ì˜ˆìƒY + ì êµ°Rect.height > ì›”ë“œRect.bottom
      ? ì›”ë“œRect.bottom - (ì êµ°Rect.top + ì êµ°Rect.height)
      : ì´ë™Y;

    ì´ë™(ëŒ€ìƒì˜¤ë¸Œì íŠ¸.name, ì´ë™X, ì´ë™Y);
    if (Math.abs(ë‚¨ì€ê±°ë¦¬X) < Math.abs(ì´ë™X)) {
      ì´ë™X = ë‚¨ì€ê±°ë¦¬X;
      ëŒ€ìƒì˜¤ë¸Œì íŠ¸.deg = 180 - ëŒ€ìƒì˜¤ë¸Œì íŠ¸.deg;
    }

    if (Math.abs(ë‚¨ì€ê±°ë¦¬Y) < Math.abs(ì´ë™Y)) {
      ì´ë™Y = ë‚¨ì€ê±°ë¦¬Y;
      ëŒ€ìƒì˜¤ë¸Œì íŠ¸.deg = 360 - ëŒ€ìƒì˜¤ë¸Œì íŠ¸.deg;
    }


    HTML(ëŒ€ìƒì˜¤ë¸Œì íŠ¸.name).style.transition =
      'all 2s linear, transform 1s ease';
    HTML(ëŒ€ìƒì˜¤ë¸Œì íŠ¸.name).style.transform = `rotate(${
      ëŒ€ìƒì˜¤ë¸Œì íŠ¸.deg + 90
    }deg)`;
  }
}
}
let ì ì¹´ìš´í„° = 0;
function ë°©í–¥ì´ë™(name, deg, px) {
  const radian = deg * (Math.PI / 180);
  const ì´ë™X = px * Math.cos(radian);
  const ì´ë™Y = px * Math.sin(radian);

  if (ì˜¤ë¸Œì íŠ¸[name]) {
    ì´ë™(name, ì´ë™X, ì´ë™Y);
  }
}

windowAlert(
  'ì¢…ì´ë¹„í–‰ê¸° í”¼í•˜ê¸° ê²Œì„',
  `<div>
  ë‹¹ì‹ ì´ í•œê°•ë¹™íŒì—ì„œ <span class="highlight">ìŠ¤ì¼€ì´íŠ¸</span>ë¥¼ íƒ€ê³  ìˆëŠ”ë°,
</div>
<div>
  ê°‘ìê¸° <span class="highlight">ì¢…ì´ë¹„í–‰ê¸°</span>ë“¤ì´ ë‚ ì•„ì™€ ë‹¹ì‹ ì„ ê´´ë¡­í™ë‹ˆë‹¤!
</div>

<div class="separator">
  <hr>
</div>

<div>
  <span class="highlight">A, S, D, W</span> í‚¤ë¡œ <span style = "width:15px;height:15px; display:inline-block;"id = "fakePlayer"></span> ë¥¼ ì´ë™í•˜ë©°
  <span class = "enemy" style = "margin-top:5px; "></span>â €â €ë“¤ì„ í”¼í•´ë³´ì„¸ìš”!
</div>

<div>
  ì²´ë ¥ì€ <span class="highlight">3ì </span>ì—ì„œ <span class = "enemy" style = "margin-top:5px; "></span>â €â €ì— ë‹¿ì„ ë•Œë§ˆë‹¤ 1ì ì”© ë‚´ë ¤ê°‘ë‹ˆë‹¤.
</div>

<div>
  ì²´ë ¥ì´ <span class = "highlight">0ì </span>ì´ ë˜ë©´ ì‚¬ë§í•©ë‹ˆë‹¤.
</div>

<div>
  <span class = "highlight">ì¢…ì´ë¹„í–‰ê¸°</span>ë“¤ë¡œë¶€í„° ìµœëŒ€í•œ ì˜¤ë˜ ì‚´ì•„ë‚¨ì•„ë³´ì„¸ìš”!
</div>

<div class="separator">
  <hr>
</div>

<div class="abilities-section">
  <span class="section-title">â–¶ëŠ¥ë ¥ì„ íƒâ—€</span>
  <div style = "font-size:11px;margin-bottom:10px; margin-top : 2px;">
      (<span class="highlight">ì—¬ëŸ¬ê°œ</span>ë„ ì„ íƒ ê°€ëŠ¥í•´ìš”! ìŠ¤í‚¬ê°œìˆ˜ ë§Œí¼ì˜ <span class = "highlight">ì ìˆ˜ê°ì </span> ì¡°ì‹¬í•˜ì„¸ìš”!)
  </div>

  <div class="skill-cards">
    <div class="skill-card" id="skill-card1" onclick='skillType = í† ê¸€(skillType,"bomb,"); HTML("#skill-card1").innerHTML = í† ê¸€(HTML("#skill-card1").innerHTML, "â†ì„ íƒë¨")'><span class="highlight">ìŠ¤í˜ì´ìŠ¤í‚¤</span>ë¥¼ ëˆŒëŸ¬ 1ì´ˆ <span class="highlight">ë¯¸ë‹ˆì‹œí•œí­íƒ„</span>ì„ ì„¤ì¹˜</div>
<div class="skill-card" id="skill-card2" onclick='skillType = í† ê¸€(skillType,"stren,"); HTML("#skill-card2").innerHTML = í† ê¸€(HTML("#skill-card2").innerHTML, "â†ì„ íƒë¨")'>ì²´ë ¥ì´ <span class="highlight">2</span>ì¦ê°€, ì†ë„ê°€ <span class="highlight">50%</span>ì¦ê°€</div>
<div class="skill-card" id="skill-card3" onclick='skillType = í† ê¸€(skillType,"lower,"); HTML("#skill-card3").innerHTML = í† ê¸€(HTML("#skill-card3").innerHTML, "â†ì„ íƒë¨")'>ì¢…ì´ë¹„í–‰ê¸°ì˜ ì†ë„ <span class="highlight">15%</span>ì¦ê°€, ê°œìˆ˜ <span class="highlight">20%</span>ê°ì†Œ</div>

  </div>
</div>

            `,
  'ì‹œì‘í•˜ê¸°',
  'ì‹œì‘();'
);
let ë ˆë²¨ = 1;
ê¸°ë³¸ì„¤ì •();
async function ì‹œì‘() {
  if(skillType.includes('stren')){playerSpeed *= (15/10);HTML('#score').max=5;HTML('#score').value=5;}
  HTML('#score').style.margin = '70px 12px';
  await new Promise((resolve) => setTimeout(resolve, 100));

  for (let i = 0; i < 30; i++) {
    if (HTML('#score').value == 0) break;

    //alert(HTML('#score').value);

    const waver = setTimeout(() => {
      // for (const key in ì˜¤ë¸Œì íŠ¸) {
      //   HTML(ì˜¤ë¸Œì íŠ¸[key].ì´ë¦„).remove();
      //   delete ì˜¤ë¸Œì íŠ¸[key];
      // }

      // 'Stage' ì—…ë°ì´íŠ¸
      if (!(HTML('#score').value == 0)) {
        HTML('#stage').innerHTML = 'Stage ' + ë ˆë²¨;
        HTML('#stage').style.animation = 'stageSet 0.8s ease';
        HTML('#world').style.filter = `contrast(${1 + (ë ˆë²¨ - 1) * 0.1})`;
        setTimeout(() => {
          HTML('#stage').style.animation = '';
        }, 800);
        let ì êµ°ìƒì„±ëŸ‰ = 10+Math.round(ë ˆë²¨*1.5);
        if(skillType.includes('lower')){ì êµ°ìƒì„±ëŸ‰ = Math.round(ì êµ°ìƒì„±ëŸ‰*=(8/10))}
        ì êµ°ìƒì„±(ì êµ°ìƒì„±ëŸ‰);
        ë ˆë²¨++;
      }
      // ì›¨ì´ë¸Œ ì‹œì‘
      const ì›¨ì´ë¸Œ = setInterval(() => {
        if (HTML('#score').value == 0) {
          clearInterval(ì›¨ì´ë¸Œ);
        } else {
          ì êµ°ì´ë™();
          ì êµ°ê±°ë¦¬ê³„ì‚°();
        }
      }, 150);

      setTimeout(() => {
        clearInterval(ì›¨ì´ë¸Œ);
      }, 10000);
    }, i * 10000);
  }
}

async function textEffect(name, content, speed) {
  const element = HTML(name);
  if (!element) {
    console.error(`ìš”ì†Œ ${name}ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
    return;
  }

  let processedContent = '';
  let index = 0;

  while (index < content.length) {
    const char = content[index];

    if (char === '<') {
      processedContent += char;
      index++;
      while (content[index] !== '>' && index < content.length) {
        processedContent += content[index];
        index++;
      }
      processedContent += '>';
    } else {
      processedContent += char;
    }

    element.innerHTML = processedContent + 'â—'; //ê²ë‚˜ ì—´ì‹¬íˆ ë§Œë“  GPT ëŠë‚Œ í…ìŠ¤íŠ¸
    if (content[index] !== ' ') {
      await new Promise((resolve) => setTimeout(resolve, speed));
    }

    index++;
  }
  element.innerHTML = processedContent;
}

async function windowAlert(title, content, act, work) {
  const windowHolder = document.createElement('div');
  windowHolder.classList.add('window-holder');

  const windowContent = document.createElement('div');
  windowContent.id = 'window';

  const centerContent = `
        <center>
        <div style="font-size:20px;font-weight:bold">${title}</div>
        <div style="margin:20px;"><hr style="width: 60%; height: 2px; background-color: #FFFFFF50; border: none;"></div>
        <p id="window-cont"></p>
        <div style="height:10px;"></div>
        <button id="close" onclick="${work} setTimeout(()=>{HTML('.window-holder').remove();},100)">${act}</button>
        </center>
    `;

  windowContent.innerHTML = centerContent;
  windowHolder.appendChild(windowContent);
  document.body.appendChild(windowHolder);
  await textEffect('#window-cont', content, 18);

  const closeButton = document.querySelector('#close');
  closeButton.style.opacity = 0;
  closeButton.style.display = 'block';
  await new Promise((resolve) => setTimeout(resolve, 10));
  closeButton.style.opacity = 1;
}
//ì´ ì½”ë“œëŠ” í•œë²ˆ ë§Œë“¤ê³  ì–¼ë§ˆë‚˜ êµ´ë ¤ë¨¹ê³  ìˆëŠ”ê±°ì•¼ ã…‹ã…‹ã…‹ã…‹

let í­íƒ„ê°œìˆ˜ = 0;
function í­íƒ„ë°°ì¹˜(x, y) {
  í­íƒ„ê°œìˆ˜++;
  const bomb = document.createElement('div');
  bomb.classList.add('bomb');
  bomb.id = `b${í­íƒ„ê°œìˆ˜}`;
  bomb.style.left = `${ì˜¤ë¸Œì íŠ¸['#player'].x + 5}px`;
  bomb.style.top = `${ì˜¤ë¸Œì íŠ¸['#player'].y + 5}px`;
  HTML('#world').appendChild(bomb);

  setTimeout(() => {
    í­ë°œ(x + 25, y + 25, bomb.id);
  }, 1000);
}
function í­ë°œ(x, y, ëŒ€ìƒì´ë¦„) {
  const ëŒ€ìƒ = HTML(`#${ëŒ€ìƒì´ë¦„}`);
  if (!ëŒ€ìƒ) {
    console.error(`ëŒ€ìƒ ${ëŒ€ìƒì´ë¦„}ì„(ë¥¼) ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);
    return; //ì´ìœ ëŠ” ëª¨ë¥´ê² ëŠ”ë° ìê¾¸ null ë¨
  }
  ëŒ€ìƒ.style.animation = `${(admin)?'ê°œì©–í­ë°œ':'í­ë°œ'} 0.8s ease-out forwards`;
  const í­ë°œí™•ì¸ = setInterval(() => {
    const í­ë°œë²”ìœ„ = ëŒ€ìƒ.getBoundingClientRect();
    for (const key in ì˜¤ë¸Œì íŠ¸) {
      const ì êµ°ì˜¤ë¸Œì íŠ¸ = ì˜¤ë¸Œì íŠ¸[key];
      if (!ì êµ°ì˜¤ë¸Œì íŠ¸.name.includes('player')) {
        const ì êµ° = HTML(ì êµ°ì˜¤ë¸Œì íŠ¸.name);
        if (!ì êµ°) continue;

        const ì êµ°Rect = ì êµ°.getBoundingClientRect();
        const ì¶©ëŒ =
          í­ë°œë²”ìœ„.left < ì êµ°Rect.right &&
          í­ë°œë²”ìœ„.right > ì êµ°Rect.left &&
          í­ë°œë²”ìœ„.top < ì êµ°Rect.bottom &&
          í­ë°œë²”ìœ„.bottom > ì êµ°Rect.top;

        if (ì¶©ëŒ) {
          //console.log(`ì êµ° ${ì êµ°ì˜¤ë¸Œì íŠ¸.name}ì´(ê°€) í­ë°œë¡œ ì œê±°ë¨.`);
          ì˜¤ë¸Œì íŠ¸[key].alive = false; // html ì€ íš¨ê³¼ ì ìš©í•´ì•¼í•´ì„œ ì¡°ê¸ˆ ìˆë‹¤ê°€ ì§€ì›Œì•¼í•¨ ã…‡ã…‡
          ì êµ°.style.animation = 'ì ì£½ìŒ 0.5s ease';
          setTimeout(() => {
            ì êµ°.remove();
            delete ì˜¤ë¸Œì íŠ¸[key];
            ì¶©ëŒì¤‘ë³µë°©ì§€ = true;
          }, 495);
        }
      }
    }
  }, 50);

  setTimeout(() => {
    clearInterval(í­ë°œí™•ì¸);
    ëŒ€ìƒ.remove();
  }, 795);
}
</script>
